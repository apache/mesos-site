<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Apache Mesos - XFS Disk Isolator in Mesos Containerizer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta property="og:locale" content="en_US"/>
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="Apache Mesos"/>
    <meta property="og:site_name" content="Apache Mesos"/>
    <meta property="og:url" content="https://mesos.apache.org/"/>
    <meta property="og:image" content="https://mesos.apache.org/assets/img/mesos_logo_fb_preview.png"/>
    <meta property="og:description"
          content="Apache Mesos abstracts resources away from machines,
                   enabling fault-tolerant and elastic distributed systems
                   to easily be built and run effectively."/>

    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:site" content="@ApacheMesos"/>
    <meta name="twitter:title" content="Apache Mesos"/>
    <meta name="twitter:image" content="https://mesos.apache.org/assets/img/mesos_logo_fb_preview.png"/>
    <meta name="twitter:description"
          content="Apache Mesos abstracts resources away from machines,
                   enabling fault-tolerant and elastic distributed systems
                   to easily be built and run effectively."/>

    <link href="../../../../assets/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="alternate" type="application/atom+xml" title="Apache Mesos Blog" href="/blog/feed.xml">
    <link href="../../../../assets/css/main.css" rel="stylesheet" />


  </head>
  <body>
    <!-- magical breadcrumbs -->
    <div class="topnav">
      <div class="container">
        <ul class="breadcrumb">
          <li>
            <div class="dropdown">
              <a data-toggle="dropdown" href="#">Apache Software Foundation <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                <li><a href="https://www.apache.org">Apache Homepage</a></li>
                <li><a href="https://www.apache.org/licenses/">License</a></li>
                <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
                <li><a href="https://www.apache.org/security/">Security</a></li>
              </ul>
            </div>
          </li>

          <li><a href="https://mesos.apache.org">Apache Mesos</a></li>
          <li><a href="/documentation/">Documentation</a></li>
        </ul><!-- /.breadcrumb -->
      </div><!-- /.container -->
    </div><!-- /.topnav -->

    <!-- navbar excitement -->
<div class="navbar navbar-default navbar-static-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#mesos-menu" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/"><img src="/assets/img/mesos_logo.png" alt="Apache Mesos logo"/></a>
    </div><!-- /.navbar-header -->

    <div class="navbar-collapse collapse" id="mesos-menu">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="/getting-started/">Getting Started</a></li>
        <li><a href="/blog/">Blog</a></li>
        <li><a href="/documentation/latest/">Documentation</a></li>
        <li><a href="/downloads/">Downloads</a></li>
        <li><a href="/community/">Community</a></li>
      </ul>
    </div><!-- /#mesos-menu -->
  </div><!-- /.container -->
</div><!-- /.navbar -->

<div class="content">
  <div class="container">
    <div class="row-fluid">
  <div class="col-md-4">
    <h4>If you're new to Mesos</h4>
    <p>See the <a href="/getting-started/">getting started</a> page for more
       information about downloading, building, and deploying Mesos.</p>

    <h4>If you'd like to get involved or you're looking for support</h4>
    <p>See our <a href="/community/">community</a> page for more details.</p>
  </div>
  <div class="col-md-8">
    <h1>XFS Disk Isolator in Mesos Containerizer</h1>

<p>The <code>disk/xfs</code> isolator uses XFS project quotas to track the disk space
used by each container sandbox and to enforce the corresponding disk
space allocation. When quota enforcement is enabled, write operations
performed by tasks exceeding their disk allocation will fail with an
<code>EDQUOT</code> error. The task will not be terminated by the containerizer.</p>

<p>To enable the XFS Disk isolator, append <code>disk/xfs</code> to the <code>--isolation</code>
flag when starting the agent.</p>

<p>The XFS Disk isolator supports the <code>--enforce_container_disk_quota</code> flag.
If enforcement is enabled, the isolator will set both the hard and soft
quota limit. Otherwise, no limits will be set, Disk usage accounting
will be performed but the task will be allowed to exceed its allocation.</p>

<p>The XFS Disk isolator requires the sandbox directory to be located
on an XFS filesystem that is mounted with the <code>pquota</code> option. There
is no need to configure
<a href="http://man7.org/linux/man-pages/man5/projects.5.html">projects</a>
or <a href="http://man7.org/linux/man-pages/man5/projid.5.html">projid</a>
files. The range of project IDs given to the <code>--xfs_project_range</code>
must not overlap any project IDs allocated for other uses.</p>

<p>The <a href="http://man7.org/linux/man-pages/man8/xfs_quota.8.html">xfs_quota</a>
command can be used to show the current allocation of project IDs
and quota. For example:</p>

<pre><code>$ xfs_quota -x -c "report -a -n -L 5000 -U 10000"
</code></pre>

<p>To show which project a file belongs to, use the
<a href="http://man7.org/linux/man-pages/man8/xfs_io.8.html">xfs_io</a> command
to display the <code>fsxattr.projid</code> field. For example:</p>

<pre><code>$ xfs_io -r -c stat /mnt/mesos/
</code></pre>

<p>Project IDs are not reclaimed until the sandboxes they were assigned to
are garbage collected. The XFS Disk isolator periodically checks if
sandboxes of terminated containers still exist and deallocates project
IDs of the ones that were removed. Such checks are performed at
intervals specified by the
<a href="/documentation/latest/isolators/configuration/agent/#disk_watch_interval"><code>--disk_watch_interval</code></a>
flag. Current number of available project IDs and total number of
project IDs used by the isolator can be tracked using
<code>containerizer/mesos/disk/project_ids_free</code> and
<code>containerizer/mesos/disk/project_ids_total</code> metrics.</p>

<h2>Killing containers</h2>

<p>The XFS Disk isolator flag <code>--xfs_kill_containers</code> will create container
quotas that have a gap between the soft and hard limits. The soft limit is
equal to the limit requested for the <code>disk</code> resource and the hard limit
is 10MB higher. If a container violates the soft limit then it will be
killed. The isolator polls for soft limit violations at the interval
specified by the <code>--container_disk_watch_interval</code> flag.</p>

<p>Note that the <code>--container_disk_watch_interval</code> flag only applies to
the XFS Disk isolator when <code>--xfs_kill_containers</code> is set to true.</p>

  </div>
</div>

  </div><!-- /.container -->
</div><!-- /.content -->

<hr>



    <!-- footer -->
    <div class="footer">
      <div class="container">

        <div class="col-md-12 trademark">
          <p>&copy; 2012-2022 <a href="https://apache.org">The Apache Software Foundation</a>.
            Apache Mesos, the Apache feather logo, and the Apache Mesos project logo are trademarks of The Apache Software Foundation.
          <p>
        </div>

      </div><!-- /.container -->
    </div><!-- /.footer -->

    <!-- JS -->
    <script src="../../../../assets/js/jquery-1.11.0.min.js"></script>
    <script src="../../../../assets/js/bootstrap.min.js"></script>
    <script src="../../../../assets/js/anchor-4.1.0.min.js"></script>

    <!-- Inject anchors for all headings on the page, see https://www.bryanbraun.com/anchorjs. -->
    <script type="text/javascript">
    anchors.options = {
      placement: 'right',
      ariaLabel: 'Permalink',
    };

    // The default is to not add anchors to h1, but we have pages with multiple h1 headers,
    // and we do want to put anchors on those.
    anchors.add('h1, h2, h3, h4, h5, h6');
    </script>
  </body>
</html>
