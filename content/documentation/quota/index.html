<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Apache Mesos - Quota</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta property="og:locale" content="en_US"/>
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="Apache Mesos"/>
    <meta property="og:site_name" content="Apache Mesos"/>
    <meta property="og:url" content="http://mesos.apache.org/"/>
    <meta property="og:image" content="http://mesos.apache.org/assets/img/mesos_logo_fb_preview.png"/>
    <meta property="og:description"
          content="Apache Mesos abstracts resources away from machines,
                   enabling fault-tolerant and elastic distributed systems
                   to easily be built and run effectively."/>

    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:site" content="@ApacheMesos"/>
    <meta name="twitter:title" content="Apache Mesos"/>
    <meta name="twitter:image" content="http://mesos.apache.org/assets/img/mesos_logo_fb_preview.png"/>
    <meta name="twitter:description"
          content="Apache Mesos abstracts resources away from machines,
                   enabling fault-tolerant and elastic distributed systems
                   to easily be built and run effectively."/>

    <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
    <link rel="alternate" type="application/atom+xml" title="Apache Mesos Blog" href="/blog/feed.xml">
    <link href="../../assets/css/main.css" rel="stylesheet" />


    <!-- Google Analytics Magic -->
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-20226872-1']);
    _gaq.push(['_setDomainName', 'apache.org']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
  </head>
  <body>
    <!-- magical breadcrumbs -->
    <div class="topnav">
      <div class="container">
        <ul class="breadcrumb">
          <li>
            <div class="dropdown">
              <a data-toggle="dropdown" href="#">Apache Software Foundation <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                <li><a href="http://www.apache.org">Apache Homepage</a></li>
                <li><a href="http://www.apache.org/licenses/">License</a></li>
                <li><a href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
                <li><a href="http://www.apache.org/security/">Security</a></li>
              </ul>
            </div>
          </li>

          <li><a href="http://mesos.apache.org">Apache Mesos</a></li>
          <li><a href="/documentation/">Documentation</a></li>
        </ul><!-- /.breadcrumb -->
      </div><!-- /.container -->
    </div><!-- /.topnav -->

    <!-- navbar excitement -->
<div class="navbar navbar-default navbar-static-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#mesos-menu" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/"><img src="/assets/img/mesos_logo.png" alt="Apache Mesos logo"/></a>
    </div><!-- /.navbar-header -->

    <div class="navbar-collapse collapse" id="mesos-menu">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="/getting-started/">Getting Started</a></li>
        <li><a href="/blog/">Blog</a></li>
        <li><a href="/documentation/latest/">Documentation</a></li>
        <li><a href="/downloads/">Downloads</a></li>
        <li><a href="/community/">Community</a></li>
      </ul>
    </div><!-- /#mesos-menu -->
  </div><!-- /.container -->
</div><!-- /.navbar -->

<div class="content">
  <div class="container">
    <div class="row-fluid">
  <div class="col-md-4">
    <h4>If you're new to Mesos</h4>
    <p>See the <a href="/getting-started/">getting started</a> page for more
       information about downloading, building, and deploying Mesos.</p>

    <h4>If you'd like to get involved or you're looking for support</h4>
    <p>See our <a href="/community/">community</a> page for more details.</p>
  </div>
  <div class="col-md-8">
    <h1>Quota</h1>

<p>When multiple users are sharing a cluster, the operator may want to set limits
on how many resources each user can use. Quota addresses this need and allows
operators to set these limits on a per-role basis.</p>

<ul>
<li><a href="#supported-resources">Supported Resources</a></li>
<li><a href="#updating-quotas">Setting Quotas</a></li>
<li><a href="#viewing-quotas">Viewing Quotas</a></li>
<li><a href="#deprecated-quota-guarantees">Deprecated: Quota Guarantees</a></li>
<li><a href="#implementation-notes">Implementation Notes</a></li>
</ul>


<h2>Supported Resources</h2>

<p>The following resources have quota support:</p>

<ul>
<li><code>cpus</code></li>
<li><code>mem</code></li>
<li><code>disk</code></li>
<li><code>gpus</code></li>
<li>any custom resource of type <code>SCALAR</code></li>
</ul>


<p>The following resources do not have quota support:</p>

<ul>
<li><code>ports</code></li>
<li>any custom resource of type <code>RANGES</code> or <code>SET</code></li>
</ul>


<h2>Updating Quotas</h2>

<p>By default, every role has no resource limits. To modify the resource limits
for one or more roles, the v1 API <code>UPDATE_QUOTA</code> call is used. Note that this
call applies the update in an all-or-nothing manner, so that if one of the
role&rsquo;s quota updates is invalid or unauthorized, the entire request will not
go through.</p>

<p>Example:</p>

<pre><code>curl --request POST \
     --url http://&lt;master-ip&gt;:&lt;master-port&gt;/api/v1/ \
     --header 'Content-Type: application/json' \
     --data '{
               "type": "UPDATE_QUOTA",
               "update_quota": {
                 "force": false,
                 "quota_configs": [
                   {
                     "role": "dev",
                     "limits": {
                       "cpus": { "value": 10 },
                       "mem":  { "value": 2048 },
                       "disk": { "value": 4096 }
                     }
                   },
                   {
                     "role": "test",
                     "limits": {
                       "cpus": { "value": 1 },
                       "mem":  { "value": 256 },
                       "disk": { "value": 512 }
                     }
                   }
                 ]
               }
             }'
</code></pre>

<ul>
<li>Note that the request will be denied if the current quota consumption is above
the provided limit. This check can be overriden by setting <code>force</code> to <code>true</code>.</li>
<li>Note that the master will attempt to rescind a sufficient number of offers to
ensure that the role cannot exceed its limits.</li>
</ul>


<h2>Viewing Quotas</h2>

<h3>Web UI</h3>

<p>The &lsquo;Roles&rsquo; tab in the web ui displays resource accounting information for all
known roles. This includes the configured quota and the quota consumption.</p>

<h3>API</h3>

<p>There are several endpoints for viewing quota related information.</p>

<p>The v1 API <code>GET_QUOTA</code> call will return the quota configuration:</p>

<pre><code>$ curl --request POST \
     --url http://&lt;master-ip&gt;:&lt;master-port&gt;/api/v1/ \
     --header 'Content-Type: application/json' \
     --header 'Accept: application/json' \
     --data '{ "type": "GET_QUOTA" }'
</code></pre>

<p>Response:</p>

<pre><code>{
  "type": "GET_QUOTA",
  "get_quota": {
    "status": {
      "infos": [
        {
          "configs" : [
            {
              "role": "dev",
              "limits": {
                "cpus": { "value": 10.0 },
                "mem":  { "value": 2048.0 },
                "disk": { "value": 4096.0 }
              }
            },
            {
              "role": "test",
              "limits": {
                "cpus": { "value": 1.0 },
                "mem":  { "value": 256.0 },
                "disk": { "value": 512.0 }
              }
            }
          ]
        }
      ]
    }
  }
}
</code></pre>

<p>To also view the quota consumption, use the <code>/roles</code> endpoint:</p>

<pre><code>$ curl http://&lt;master-ip&gt;:&lt;master-port&gt;/roles
</code></pre>

<p>Response</p>

<pre><code>{
  "roles": [
    {
      "name": "dev",
      "weight": 1.0,
      "quota":
      {
        "role": "dev",
        "limit": {
          "cpus": 10.0,
          "mem":  2048.0,
          "disk": 4096.0
        },
        "consumed": {
          "cpus": 2.0,
          "mem":  1024.0,
          "disk": 2048.0
        }
      },
      "allocated": {
        "cpus": 2.0,
        "mem":  1024.0,
        "disk": 2048.0
      },
      "offered": {},
      "reserved": {
        "cpus": 2.0,
        "mem":  1024.0,
        "disk": 2048.0
      },
      "frameworks": []
    }
  ]
}
</code></pre>

<h3>Quota Consumption</h3>

<p>A role&rsquo;s quota consumption consists of its allocations and reservations.
In other words, even if reservations are not allocated, they are included
in the quota consumption. Offered resources are not charged against quota.</p>

<h3>Metrics</h3>

<p>The following metric keys are exposed for quota:</p>

<ul>
<li><code>allocator/mesos/quota/roles/&lt;role&gt;/resources/&lt;resource&gt;/guarantee</code></li>
<li><code>allocator/mesos/quota/roles/&lt;role&gt;/resources/&lt;resource&gt;/limit</code></li>
<li>A quota consumption metric will be added via
<a href="https://issues.apache.org/jira/browse/MESOS-9123">MESOS-9123</a>.</li>
</ul>


<h2>Deprecated: Quota Guarantees</h2>

<p>Prior to Mesos 1.9, the quota related APIs only exposed quota &ldquo;guarantees&rdquo;
which ensured a minimum amount of resources would be available to a role.
Setting guarantees also set implicit quota limits. In Mesos 1.9+, quota
limits are now exposed directly per the above documentation.</p>

<p>Quota guarantees are now deprecated in favor of using only quota limits.
Enforcement of quota guarantees required that Mesos holds back enough
resources to meet all of the unsatisfied quota guarantees. Since Mesos is
moving towards an optimistic offer model (to improve multi-role / multi-
scheduler scalability, see
<a href="https://issues.apache.org/jira/browse/MESOS-1607">MESOS-1607</a>), it will
become no longer possible to enforce quota guarantees by holding back
resources. In such a model, quota limits are simple to enforce, but quota
guarantees would require a complex &ldquo;effective limit&rdquo; propagation model to
leave space for unsatisfied guarantees.</p>

<p>For these reasons, quota guarantees, while still functional in Mesos 1.9,
are now deprecated. A combination of limits and priority based preemption
will be simpler in an optimistic offer model.</p>

<p>For documentation on quota guarantees, please see the previous
documentation: <a href="https://github.com/apache/mesos/blob/1.8.0/docs/quota.md">https://github.com/apache/mesos/blob/1.8.0/docs/quota.md</a></p>

<h2>Implementation Notes</h2>

<ul>
<li>Quota is not supported for the default <code>*</code> role.</li>
<li>Quota is not supported on nested roles (e.g. <code>eng/prod</code>).</li>
<li>During failover, in order to correctly enforce limits, the allocator
will be paused and will not issue offers until at least 80% agents
re-register or 10 minutes elapses. These parameters will be made
configurable: <a href="https://issues.apache.org/jira/browse/MESOS-4073">MESOS-4073</a></li>
</ul>


  </div>
</div>

  </div><!-- /.container -->
</div><!-- /.content -->

<hr>



    <!-- footer -->
    <div class="footer">
      <div class="container">

        <div class="col-md-3">
            <a  href="https://www.apache.org/events/current-event.html">
              <img src="https://www.apache.org/events/current-event-234x60.png"/>
            </a>
        </div>

        <div class="col-md-3 social-blk">
          <span class="social">
            <a href="https://twitter.com/ApacheMesos"
              class="twitter-follow-button"
              data-show-count="false" data-size="large">Follow @ApacheMesos</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
            <a href="https://twitter.com/intent/tweet?button_hashtag=mesos"
              class="twitter-hashtag-button"
              data-size="large"
              data-related="ApacheMesos">Tweet #mesos</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
          </span>
        </div>

        <div class="col-md-6 trademark">
          <p>&copy; 2012-2018 <a href="http://apache.org">The Apache Software Foundation</a>.
            Apache Mesos, the Apache feather logo, and the Apache Mesos project logo are trademarks of The Apache Software Foundation.
          <p>
        </div>

      </div><!-- /.container -->
    </div><!-- /.footer -->

    <!-- JS -->
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js"></script>

    <!-- Inject anchors for all headings on the page, see https://www.bryanbraun.com/anchorjs. -->
    <script type="text/javascript">
    anchors.options = {
      placement: 'right',
      ariaLabel: 'Permalink',
    };

    // The default is to not add anchors to h1, but we have pages with multiple h1 headers,
    // and we do want to put anchors on those.
    anchors.add('h1, h2, h3, h4, h5, h6');
    </script>
  </body>
</html>
